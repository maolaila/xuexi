### 13webpack的增量构建

需要同时开启watch和cache，才能实现增量构建的效果；

##### 增量构建原理

cache配置：

一般默认为false，开发模式开启watch的情况先，默认值为true，若为对象，表示用该对象作为缓存对象；用于多个compiler的调用情况；

原理：

​	watch模式下，在构建完成后并不会退出，所以上次构建的上下文和数据会被保留，在后续构建中可以使用到上次构建的上下文和数据

​	cache：

- 编译模块阶段：如果命中缓存后，则会直接跳过对应module的编译过程；
- 生成产物代码：没法通过第三方插件进行处理，如果命中缓存，则会跳过该Chunk的生成产物代码的过程；

通过webpack的内置cache插件，将整个构建过程中相对耗时的内部处理环节--编译模块（module）和生成产物进行缓存的读写处理，从而实现增量构建；

##### 生产环境下使用增量构建的阻碍

增量构建之所以快是因为将构建所需数据保存在内存中，对于管理多项目的构建系统而言，构建过程是任务式的：即在构建任务完成后结束进程并收回系统资源；

所以要想在生产环境提升构建速度，首先是要将缓存写入系统文件中；

webpack4的cache只支持内存缓存，不支持文件系统缓存；webpack5是支持文件系统的持久化缓存的；

总结：在webpack4中

watch：保留进程，是的初次构建后的数据对象能够在后续构建中多次复用；

cache：在添加模块与生成产物代码时，可以利用cache对象进行相应阶段结果数据的读写；



##### 问题：为什么在其增量构建后，有时候rebuild还会很慢呢？

原因：wabpack4中的增量构建仅仅作用在新增模块和生成Chunk的阶段，其他处理任务仍须通过其他方式进行优化；或者是过程中的一些处理会额外增加构建时间，例如开启sourceMap等；