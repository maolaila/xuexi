### 15无包构建

##### 打包工具

基于一个或多个入口模块，通过依赖分析将有依赖关系的模块打包到一起，最后形成几个少数产物，包含了模块编译和代码优化等功能；因此是打包式的构建工具；

##### 无包构建

在构建时只需处理模块编译，而无需打包，把模块间依赖关系完全交给浏览器处理，当浏览器解析到这个模块需要依赖其他模块时，会自动通过网络请求去加载被依赖的模块资源；

大部分浏览器都支持这种javascript modules的特性

##### 使用

- 入口模块文件在页面中引用时需要带上type="module"属性`<script type="module" />`
- 带有type="module"属性的script标签有上defer属性，defer不会阻塞html渲染，它是异步并行请求该资源，即使请求完了，也会等html渲染完成后才执行，在contentDomLoaded之后执行，按照书写顺序执行；
- 带有type="module"属性的script标签有async属性，async会阻塞html渲染，它是异步并行请求该资源，当请求完成时就加载该资源，并且不会按照书写顺序执行，是按照资源加载完成的顺序；
- 即使多次加载相同模块，也只会执行一次；
- 只能使用es6风格的模块导入方式；
- 导入的模块只支持相对路径和url的方式，不支持直接使用包名的方式
- 只支持text/javascript方式的模块，不支持其他类型文件加载，例如CSS等；

##### 问题

- js之外其他类型的文件需要编译处理为es6模块才能被加载；
- 许多三方依赖包通过第三方url引用时过程繁琐，难以进行灵活的版本控制和更新；
- 对于现实开发而言，一些便利的辅助开发技术需要构建工具提供；

##### 无包构建工具

###### vite

基于Native-ESM的web构建工具，开发环境下基于Native-ESM处理构建过程，只编译不打包，生产环境则基于Rollup打包；

```
npm init vite-app my-vite-demo
cd ./my-vite-demo
npm i
npm run dev
```

vite还提供了Vue，React等框架对应的 脚手架模板，并且对这几个框架都内置了HMR功能，也提供HMR的API供第三方插件或项目代码使用；

可自定义配置文件来细化配置；

支持了https/http2

支持服务代理，将部分请求代理到第三方

根据mode指定构建模式，相应模式下自动读取对应的环境变量配置文件（.env文件）；

生产环境使用Rollup打包，支持传入自定义配置；

只支持es6的现代浏览器，对vue框架目前只支持vue3版本，不兼容vue2；

vite内置了针对vue大量的构建优化



###### Snowpack

生产环境下默认使用无包构建，Vite仅在开发模式下使用；

需要引入插件实现打包功能；

​	

##### 优点

- 初次构建启动快
- 按需编译
- 增量构建速度快

##### 缺点

- 浏览器网络请求量剧增，对页面渲染造成延迟，尤其是不支持http2的服务，因为http1有上限
- 浏览器兼容性不好





